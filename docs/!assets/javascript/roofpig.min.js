THREE.RenderableObject=function(){this.id=0,this.object=null,this.z=0},THREE.RenderableFace=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.normalModel=new THREE.Vector3,this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.vertexNormalsLength=0,this.color=new THREE.Color,this.material=null,this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2],this.z=0},THREE.RenderableVertex=function(){this.position=new THREE.Vector3,this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.visible=!0},THREE.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},THREE.RenderableLine=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.vertexColors=[new THREE.Color,new THREE.Color],this.material=null,this.z=0},THREE.RenderableSprite=function(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new THREE.Vector2,this.material=null},THREE.Projector=function(){function e(){if(c===x){var e=new THREE.RenderableObject;return d.push(e),x++,c++,e}return d[c++]}function t(){if(p===y){var e=new THREE.RenderableVertex;return T.push(e),y++,p++,e}return T[p++]}function r(){if(u===w){var e=new THREE.RenderableFace;return H.push(e),w++,u++,e}return H[u++]}function i(){if(v===b){var e=new THREE.RenderableLine;return g.push(e),b++,v++,e}return g[v++]}function o(){if(m===S){var e=new THREE.RenderableSprite;return M.push(e),S++,m++,e}return M[m++]}function n(e,t){return e.z!==t.z?t.z-e.z:e.id!==t.id?e.id-t.id:0}function a(e,t){var r=0,i=1,o=e.z+e.w,n=t.z+t.w,a=-e.z+e.w,s=-t.z+t.w;return o>=0&&n>=0&&a>=0&&s>=0||!(o<0&&n<0||a<0&&s<0)&&(o<0?r=Math.max(r,o/(o-n)):n<0&&(i=Math.min(i,o/(o-n))),a<0?r=Math.max(r,a/(a-s)):s<0&&(i=Math.min(i,a/(a-s))),!(i<r)&&(e.lerp(t,r),t.lerp(e,1-i),!0))}var s,c,l,p,E,u,h,v,f,m,R,d=[],x=0,T=[],y=0,H=[],w=0,g=[],b=0,M=[],S=0,z={objects:[],lights:[],elements:[]},V=new THREE.Vector3,j=new THREE.Vector4,L=new THREE.Box3(new THREE.Vector3((-1),(-1),(-1)),new THREE.Vector3(1,1,1)),C=new THREE.Box3,k=new Array(3),N=(new Array(4),new THREE.Matrix4),W=new THREE.Matrix4,B=new THREE.Matrix4,F=new THREE.Matrix3,P=new THREE.Frustum,I=new THREE.Vector4,O=new THREE.Vector4;this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(e,t){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")};var D=function(){var e=[],o=[],n=null,a=null,s=new THREE.Matrix3,c=function(t){n=t,a=n.material,s.getNormalMatrix(n.matrixWorld),e.length=0,o.length=0},p=function(e){var t=e.position,r=e.positionWorld,i=e.positionScreen;r.copy(t).applyMatrix4(R),i.copy(r).applyMatrix4(W);var o=1/i.w;i.x*=o,i.y*=o,i.z*=o,e.visible=i.x>=-1&&i.x<=1&&i.y>=-1&&i.y<=1&&i.z>=-1&&i.z<=1},u=function(e,r,i){l=t(),l.position.set(e,r,i),p(l)},v=function(t,r,i){e.push(t,r,i)},f=function(e,t){o.push(e,t)},m=function(e,t,r){return e.visible===!0||t.visible===!0||r.visible===!0||(k[0]=e.positionScreen,k[1]=t.positionScreen,k[2]=r.positionScreen,L.isIntersectionBox(C.setFromPoints(k)))},d=function(e,t,r){return(r.positionScreen.x-e.positionScreen.x)*(t.positionScreen.y-e.positionScreen.y)-(r.positionScreen.y-e.positionScreen.y)*(t.positionScreen.x-e.positionScreen.x)<0},x=function(e,t){var r=T[e],o=T[t];h=i(),h.id=n.id,h.v1.copy(r),h.v2.copy(o),h.z=(r.positionScreen.z+o.positionScreen.z)/2,h.material=n.material,z.elements.push(h)},y=function(t,i,c){var l=T[t],p=T[i],u=T[c];if(m(l,p,u)!==!1&&(a.side===THREE.DoubleSide||d(l,p,u)===!0)){E=r(),E.id=n.id,E.v1.copy(l),E.v2.copy(p),E.v3.copy(u),E.z=(l.positionScreen.z+p.positionScreen.z+u.positionScreen.z)/3;for(var h=0;h<3;h++){var v=3*arguments[h],f=E.vertexNormalsModel[h];f.set(e[v],e[v+1],e[v+2]),f.applyMatrix3(s).normalize();var R=2*arguments[h],x=E.uvs[h];x.set(o[R],o[R+1])}E.vertexNormalsLength=3,E.material=n.material,z.elements.push(E)}};return{setObject:c,projectVertex:p,checkTriangleVisibility:m,checkBackfaceCulling:d,pushVertex:u,pushNormal:v,pushUv:f,pushLine:x,pushTriangle:y}},G=new D;this.projectScene=function(l,d,x,y){u=0,v=0,m=0,z.elements.length=0,l.autoUpdate===!0&&l.updateMatrixWorld(),void 0===d.parent&&d.updateMatrixWorld(),N.copy(d.matrixWorldInverse.getInverse(d.matrixWorld)),W.multiplyMatrices(d.projectionMatrix,N),P.setFromMatrix(W),c=0,z.objects.length=0,z.lights.length=0,l.traverseVisible(function(t){if(t instanceof THREE.Light)z.lights.push(t);else if(t instanceof THREE.Mesh||t instanceof THREE.Line||t instanceof THREE.Sprite){if(t.material.visible===!1)return;t.frustumCulled!==!1&&P.intersectsObject(t)!==!0||(s=e(),s.id=t.id,s.object=t,V.setFromMatrixPosition(t.matrixWorld),V.applyProjection(W),s.z=V.z,z.objects.push(s))}}),x===!0&&z.objects.sort(n);for(var H=0,w=z.objects.length;H<w;H++){var g=z.objects[H].object,b=g.geometry;if(G.setObject(g),R=g.matrixWorld,p=0,g instanceof THREE.Mesh){if(b instanceof THREE.BufferGeometry){var M=b.attributes,S=b.offsets;if(void 0===M.position)continue;for(var L=M.position.array,C=0,k=L.length;C<k;C+=3)G.pushVertex(L[C],L[C+1],L[C+2]);if(void 0!==M.normal)for(var D=M.normal.array,C=0,k=D.length;C<k;C+=3)G.pushNormal(D[C],D[C+1],D[C+2]);if(void 0!==M.uv)for(var U=M.uv.array,C=0,k=U.length;C<k;C+=2)G.pushUv(U[C],U[C+1]);if(void 0!==M.index){var A=M.index.array;if(S.length>0)for(var H=0;H<S.length;H++)for(var q=S[H],J=q.index,C=q.start,k=q.start+q.count;C<k;C+=3)G.pushTriangle(A[C]+J,A[C+1]+J,A[C+2]+J);else for(var C=0,k=A.length;C<k;C+=3)G.pushTriangle(A[C],A[C+1],A[C+2])}else for(var C=0,k=L.length/3;C<k;C+=3)G.pushTriangle(C,C+1,C+2)}else if(b instanceof THREE.Geometry){var K=b.vertices,Q=b.faces,X=b.faceVertexUvs[0];F.getNormalMatrix(R);for(var Y=g.material,Z=Y instanceof THREE.MeshFaceMaterial,$=Z===!0?g.material:null,_=0,ee=K.length;_<ee;_++){var te=K[_];if(V.copy(te),Y.morphTargets===!0)for(var re=b.morphTargets,ie=g.morphTargetInfluences,oe=0,ne=re.length;oe<ne;oe++){var ae=ie[oe];if(0!==ae){var se=re[oe],ce=se.vertices[_];V.x+=(ce.x-te.x)*ae,V.y+=(ce.y-te.y)*ae,V.z+=(ce.z-te.z)*ae}}G.pushVertex(V.x,V.y,V.z)}for(var le=0,pe=Q.length;le<pe;le++){var Ee=Q[le],Y=Z===!0?$.materials[Ee.materialIndex]:g.material;if(void 0!==Y){var ue=Y.side,he=T[Ee.a],ve=T[Ee.b],fe=T[Ee.c];if(G.checkTriangleVisibility(he,ve,fe)!==!1){var me=G.checkBackfaceCulling(he,ve,fe);if(ue!==THREE.DoubleSide){if(ue===THREE.FrontSide&&me===!1)continue;if(ue===THREE.BackSide&&me===!0)continue}E=r(),E.id=g.id,E.v1.copy(he),E.v2.copy(ve),E.v3.copy(fe),E.normalModel.copy(Ee.normal),me!==!1||ue!==THREE.BackSide&&ue!==THREE.DoubleSide||E.normalModel.negate(),E.normalModel.applyMatrix3(F).normalize();for(var Re=Ee.vertexNormals,de=0,xe=Math.min(Re.length,3);de<xe;de++){var Te=E.vertexNormalsModel[de];Te.copy(Re[de]),me!==!1||ue!==THREE.BackSide&&ue!==THREE.DoubleSide||Te.negate(),Te.applyMatrix3(F).normalize()}E.vertexNormalsLength=Re.length;var ye=X[le];if(void 0!==ye)for(var He=0;He<3;He++)E.uvs[He].copy(ye[He]);E.color=Ee.color,E.material=Y,E.z=(he.positionScreen.z+ve.positionScreen.z+fe.positionScreen.z)/3,z.elements.push(E)}}}}}else if(g instanceof THREE.Line){if(b instanceof THREE.BufferGeometry){var M=b.attributes;if(void 0!==M.position){for(var L=M.position.array,C=0,k=L.length;C<k;C+=3)G.pushVertex(L[C],L[C+1],L[C+2]);if(void 0!==M.index)for(var A=M.index.array,C=0,k=A.length;C<k;C+=2)G.pushLine(A[C],A[C+1]);else for(var we=g.mode===THREE.LinePieces?2:1,C=0,k=L.length/3-1;C<k;C+=we)G.pushLine(C,C+1)}}else if(b instanceof THREE.Geometry){B.multiplyMatrices(W,R);var K=g.geometry.vertices;if(0===K.length)continue;he=t(),he.positionScreen.copy(K[0]).applyMatrix4(B);for(var we=g.mode===THREE.LinePieces?2:1,_=1,ee=K.length;_<ee;_++)he=t(),he.positionScreen.copy(K[_]).applyMatrix4(B),(_+1)%we>0||(ve=T[p-2],I.copy(he.positionScreen),O.copy(ve.positionScreen),a(I,O)===!0&&(I.multiplyScalar(1/I.w),O.multiplyScalar(1/O.w),h=i(),h.id=g.id,h.v1.positionScreen.copy(I),h.v2.positionScreen.copy(O),h.z=Math.max(I.z,O.z),h.material=g.material,g.material.vertexColors===THREE.VertexColors&&(h.vertexColors[0].copy(g.geometry.colors[_]),h.vertexColors[1].copy(g.geometry.colors[_-1])),z.elements.push(h)))}}else if(g instanceof THREE.Sprite){j.set(R.elements[12],R.elements[13],R.elements[14],1),j.applyMatrix4(W);var ge=1/j.w;j.z*=ge,j.z>=-1&&j.z<=1&&(f=o(),f.id=g.id,f.x=j.x*ge,f.y=j.y*ge,f.z=j.z,f.object=g,f.rotation=g.rotation,f.scale.x=g.scale.x*Math.abs(f.x-(j.x+d.projectionMatrix.elements[0])/(j.w+d.projectionMatrix.elements[12])),f.scale.y=g.scale.y*Math.abs(f.y-(j.y+d.projectionMatrix.elements[5])/(j.w+d.projectionMatrix.elements[13])),f.material=g.material,z.elements.push(f))}}return y===!0&&z.elements.sort(n),z}};
THREE.SpriteCanvasMaterial=function(e){THREE.Material.call(this),this.type="SpriteCanvasMaterial",this.color=new THREE.Color(16777215),this.program=function(e,t){},this.setValues(e)},THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype),THREE.SpriteCanvasMaterial.prototype.constructor=THREE.SpriteCanvasMaterial,THREE.SpriteCanvasMaterial.prototype.clone=function(){var e=new THREE.SpriteCanvasMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.program=this.program,e},THREE.CanvasRenderer=function(e){function t(){Re.setRGB(0,0,0),ve.setRGB(0,0,0),Se.setRGB(0,0,0);for(var e=0,t=w.length;e<t;e++){var i=w[e],n=i.color;i instanceof THREE.AmbientLight?Re.add(n):i instanceof THREE.DirectionalLight?ve.add(n):i instanceof THREE.PointLight&&Se.add(n)}}function i(e,t,i){for(var n=0,o=w.length;n<o;n++){var r=w[n];if(de.copy(r.color),r instanceof THREE.DirectionalLight){var a=Te.setFromMatrixPosition(r.matrixWorld).normalize(),s=t.dot(a);if(s<=0)continue;s*=r.intensity,i.add(de.multiplyScalar(s))}else if(r instanceof THREE.PointLight){var a=Te.setFromMatrixPosition(r.matrixWorld),s=t.dot(Te.subVectors(a,e).normalize());if(s<=0)continue;if(s*=0==r.distance?1:1-Math.min(e.distanceTo(a)/r.distance,1),0==s)continue;s*=r.intensity,i.add(de.multiplyScalar(s))}}}function n(e,t,i){h(i.opacity),d(i.blending);var n=t.scale.x*K,o=t.scale.y*Q,r=.5*Math.sqrt(n*n+o*o);if(ue.min.set(e.x-r,e.y-r),ue.max.set(e.x+r,e.y+r),i instanceof THREE.SpriteMaterial){var a=i.map;if(null!==a&&void 0!==a.image){a.hasEventListener("update",c)===!1&&(a.image.width>0&&p(a),a.addEventListener("update",c));var s=me[a.id];R(void 0!==s?s:"rgba( 0, 0, 0, 1 )");var l=a.image,E=l.width*a.offset.x,f=l.height*a.offset.y,m=l.width*a.repeat.x,x=l.height*a.repeat.y,y=n/m,v=o/x;ee.save(),ee.translate(e.x,e.y),0!==i.rotation&&ee.rotate(i.rotation),ee.translate(-n/2,-o/2),ee.scale(y,v),ee.translate(-E,-f),ee.fillRect(E,f,m,x),ee.restore()}else R(i.color.getStyle()),ee.save(),ee.translate(e.x,e.y),0!==i.rotation&&ee.rotate(i.rotation),ee.scale(n,-o),ee.fillRect(-.5,-.5,1,1),ee.restore()}else i instanceof THREE.SpriteCanvasMaterial&&(u(i.color.getStyle()),R(i.color.getStyle()),ee.save(),ee.translate(e.x,e.y),0!==i.rotation&&ee.rotate(i.rotation),ee.scale(n,o),i.program(ee),ee.restore())}function o(e,t,i,n){if(h(n.opacity),d(n.blending),ee.beginPath(),ee.moveTo(e.positionScreen.x,e.positionScreen.y),ee.lineTo(t.positionScreen.x,t.positionScreen.y),n instanceof THREE.LineBasicMaterial){if(m(n.linewidth),x(n.linecap),y(n.linejoin),n.vertexColors!==THREE.VertexColors)u(n.color.getStyle());else{var o=i.vertexColors[0].getStyle(),r=i.vertexColors[1].getStyle();if(o===r)u(o);else{try{var a=ee.createLinearGradient(e.positionScreen.x,e.positionScreen.y,t.positionScreen.x,t.positionScreen.y);a.addColorStop(0,o),a.addColorStop(1,r)}catch(e){a=o}u(a)}}ee.stroke(),ue.expandByScalar(2*n.linewidth)}else n instanceof THREE.LineDashedMaterial&&(m(n.linewidth),x(n.linecap),y(n.linejoin),u(n.color.getStyle()),v([n.dashSize,n.gapSize]),ee.stroke(),ue.expandByScalar(2*n.linewidth),v([]))}function r(e,t,n,o,r,c,p,f){if(I.info.render.vertices+=3,I.info.render.faces++,h(f.opacity),d(f.blending),b=e.positionScreen.x,B=e.positionScreen.y,P=t.positionScreen.x,z=t.positionScreen.y,V=n.positionScreen.x,j=n.positionScreen.y,a(b,B,P,z,V,j),(f instanceof THREE.MeshLambertMaterial||f instanceof THREE.MeshPhongMaterial)&&null===f.map)fe.copy(f.color),he.copy(f.emissive),f.vertexColors===THREE.FaceColors&&fe.multiply(p.color),Ee.copy(Re),ge.copy(e.positionWorld).add(t.positionWorld).add(n.positionWorld).divideScalar(3),i(ge,p.normalModel,Ee),Ee.multiply(fe).add(he),f.wireframe===!0?s(Ee,f.wireframeLinewidth,f.wireframeLinecap,f.wireframeLinejoin):l(Ee);else if(f instanceof THREE.MeshBasicMaterial||f instanceof THREE.MeshLambertMaterial||f instanceof THREE.MeshPhongMaterial)if(null!==f.map){var m=f.map.mapping;m===THREE.UVMapping&&(D=p.uvs,E(b,B,P,z,V,j,D[o].x,D[o].y,D[r].x,D[r].y,D[c].x,D[c].y,f.map))}else null!==f.envMap?f.envMap.mapping===THREE.SphericalReflectionMapping&&(we.copy(p.vertexNormalsModel[o]).applyMatrix3(He),W=.5*we.x+.5,F=.5*we.y+.5,we.copy(p.vertexNormalsModel[r]).applyMatrix3(He),N=.5*we.x+.5,k=.5*we.y+.5,we.copy(p.vertexNormalsModel[c]).applyMatrix3(He),O=.5*we.x+.5,G=.5*we.y+.5,E(b,B,P,z,V,j,W,F,N,k,O,G,f.envMap)):(Ee.copy(f.color),f.vertexColors===THREE.FaceColors&&Ee.multiply(p.color),f.wireframe===!0?s(Ee,f.wireframeLinewidth,f.wireframeLinecap,f.wireframeLinejoin):l(Ee));else f instanceof THREE.MeshDepthMaterial?(Ee.r=Ee.g=Ee.b=1-S(e.positionScreen.z*e.positionScreen.w,H.near,H.far),f.wireframe===!0?s(Ee,f.wireframeLinewidth,f.wireframeLinecap,f.wireframeLinejoin):l(Ee)):f instanceof THREE.MeshNormalMaterial?(we.copy(p.normalModel).applyMatrix3(He),Ee.setRGB(we.x,we.y,we.z).multiplyScalar(.5).addScalar(.5),f.wireframe===!0?s(Ee,f.wireframeLinewidth,f.wireframeLinecap,f.wireframeLinejoin):l(Ee)):(Ee.setRGB(1,1,1),f.wireframe===!0?s(Ee,f.wireframeLinewidth,f.wireframeLinecap,f.wireframeLinejoin):l(Ee))}function a(e,t,i,n,o,r){ee.beginPath(),ee.moveTo(e,t),ee.lineTo(i,n),ee.lineTo(o,r),ee.closePath()}function s(e,t,i,n){m(t),x(i),y(n),u(e.getStyle()),ee.stroke(),ue.expandByScalar(2*t)}function l(e){R(e.getStyle()),ee.fill()}function c(e){p(e.target)}function p(e){if(!(e instanceof THREE.CompressedTexture)){var t=e.wrapS===THREE.RepeatWrapping,i=e.wrapT===THREE.RepeatWrapping,n=e.image,o=document.createElement("canvas");o.width=n.width,o.height=n.height;var r=o.getContext("2d");r.setTransform(1,0,0,-1,0,n.height),r.drawImage(n,0,0),me[e.id]=ee.createPattern(o,t===!0&&i===!0?"repeat":t===!0&&i===!1?"repeat-x":t===!1&&i===!0?"repeat-y":"no-repeat")}}function E(e,t,i,n,o,r,a,s,l,E,f,h,d){if(!(d instanceof THREE.DataTexture)){d.hasEventListener("update",c)===!1&&(void 0!==d.image&&d.image.width>0&&p(d),d.addEventListener("update",c));var m=me[d.id];if(void 0===m)return R("rgba(0,0,0,1)"),void ee.fill();R(m);var x,y,u,v,S,T,g,w,H=d.offset.x/d.repeat.x,C=d.offset.y/d.repeat.y,M=d.image.width*d.repeat.x,L=d.image.height*d.repeat.y;a=(a+H)*M,s=(s+C)*L,l=(l+H)*M,E=(E+C)*L,f=(f+H)*M,h=(h+C)*L,i-=e,n-=t,o-=e,r-=t,l-=a,E-=s,f-=a,h-=s,g=l*h-f*E,0!==g&&(w=1/g,x=(h*i-E*o)*w,y=(h*n-E*r)*w,u=(l*o-f*i)*w,v=(l*r-f*n)*w,S=e-x*a-u*s,T=t-y*a-v*s,ee.save(),ee.transform(x,y,u,v,S,T),ee.fill(),ee.restore())}}function f(e,t,i){var n,o=t.x-e.x,r=t.y-e.y,a=o*o+r*r;0!==a&&(n=i/Math.sqrt(a),o*=n,r*=n,t.x+=o,t.y+=r,e.x-=o,e.y-=r)}function h(e){ne!==e&&(ee.globalAlpha=e,ne=e)}function d(e){oe!==e&&(e===THREE.NormalBlending?ee.globalCompositeOperation="source-over":e===THREE.AdditiveBlending?ee.globalCompositeOperation="lighter":e===THREE.SubtractiveBlending&&(ee.globalCompositeOperation="darker"),oe=e)}function m(e){se!==e&&(ee.lineWidth=e,se=e)}function x(e){le!==e&&(ee.lineCap=e,le=e)}function y(e){ce!==e&&(ee.lineJoin=e,ce=e)}function u(e){re!==e&&(ee.strokeStyle=e,re=e)}function R(e){ae!==e&&(ee.fillStyle=e,ae=e)}function v(e){pe.length!==e.length&&(ee.setLineDash(e),pe=e)}console.log("THREE.CanvasRenderer",THREE.REVISION);var S=THREE.Math.smoothstep;e=e||{};var T,g,w,H,C,M,L,b,B,P,z,V,j,D,W,F,N,k,O,G,I=this,A=new THREE.Projector,q=void 0!==e.canvas?e.canvas:document.createElement("canvas"),U=q.width,J=q.height,K=Math.floor(U/2),Q=Math.floor(J/2),X=0,Y=0,Z=U,$=J,_=1,ee=q.getContext("2d",{alpha:e.alpha===!0}),te=new THREE.Color(0),ie=e.alpha===!0?0:1,ne=1,oe=0,re=null,ae=null,se=null,le=null,ce=null,pe=[],Ee=(new THREE.RenderableVertex,new THREE.RenderableVertex,new THREE.Color),fe=(new THREE.Color,new THREE.Color,new THREE.Color,new THREE.Color,new THREE.Color),he=new THREE.Color,de=new THREE.Color,me={},xe=new THREE.Box2,ye=new THREE.Box2,ue=new THREE.Box2,Re=new THREE.Color,ve=new THREE.Color,Se=new THREE.Color,Te=new THREE.Vector3,ge=new THREE.Vector3,we=new THREE.Vector3,He=new THREE.Matrix3;void 0===ee.setLineDash&&(ee.setLineDash=function(){}),this.domElement=q,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.info={render:{vertices:0,faces:0}},this.supportsVertexTextures=function(){},this.setFaceCulling=function(){},this.getPixelRatio=function(){return _},this.setPixelRatio=function(e){_=e},this.setSize=function(e,t,i){U=e*_,J=t*_,q.width=U,q.height=J,K=Math.floor(U/2),Q=Math.floor(J/2),i!==!1&&(q.style.width=e+"px",q.style.height=t+"px"),xe.min.set(-K,-Q),xe.max.set(K,Q),ye.min.set(-K,-Q),ye.max.set(K,Q),ne=1,oe=0,re=null,ae=null,se=null,le=null,ce=null,this.setViewport(0,0,e,t)},this.setViewport=function(e,t,i,n){X=e*_,Y=t*_,Z=i*_,$=n*_},this.setScissor=function(){},this.enableScissorTest=function(){},this.setClearColor=function(e,t){te.set(e),ie=void 0!==t?t:1,ye.min.set(-K,-Q),ye.max.set(K,Q)},this.setClearColorHex=function(e,t){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getClearColor=function(){return te},this.getClearAlpha=function(){return ie},this.getMaxAnisotropy=function(){return 0},this.clear=function(){ye.empty()===!1&&(ye.intersect(xe),ye.expandByScalar(2),ye.min.x=ye.min.x+K,ye.min.y=-ye.min.y+Q,ye.max.x=ye.max.x+K,ye.max.y=-ye.max.y+Q,ie<1&&ee.clearRect(0|ye.min.x,0|ye.max.y,ye.max.x-ye.min.x|0,ye.min.y-ye.max.y|0),ie>0&&(d(THREE.NormalBlending),h(1),R("rgba("+Math.floor(255*te.r)+","+Math.floor(255*te.g)+","+Math.floor(255*te.b)+","+ie+")"),ee.fillRect(0|ye.min.x,0|ye.max.y,ye.max.x-ye.min.x|0,ye.min.y-ye.max.y|0)),ye.makeEmpty())},this.clearColor=function(){},this.clearDepth=function(){},this.clearStencil=function(){},this.render=function(e,i){if(i instanceof THREE.Camera==!1)return void console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");this.autoClear===!0&&this.clear(),I.info.render.vertices=0,I.info.render.faces=0,ee.setTransform(Z/U,0,0,-$/J,X,J-Y),ee.translate(K,Q),T=A.projectScene(e,i,this.sortObjects,this.sortElements),g=T.elements,w=T.lights,H=i,He.getNormalMatrix(i.matrixWorldInverse),t();for(var a=0,s=g.length;a<s;a++){var l=g[a],c=l.material;if(void 0!==c&&0!==c.opacity){if(ue.makeEmpty(),l instanceof THREE.RenderableSprite)C=l,C.x*=K,C.y*=Q,n(C,l,c);else if(l instanceof THREE.RenderableLine)C=l.v1,M=l.v2,C.positionScreen.x*=K,C.positionScreen.y*=Q,M.positionScreen.x*=K,M.positionScreen.y*=Q,ue.setFromPoints([C.positionScreen,M.positionScreen]),xe.isIntersectionBox(ue)===!0&&o(C,M,l,c);else if(l instanceof THREE.RenderableFace){if(C=l.v1,M=l.v2,L=l.v3,C.positionScreen.z<-1||C.positionScreen.z>1)continue;if(M.positionScreen.z<-1||M.positionScreen.z>1)continue;if(L.positionScreen.z<-1||L.positionScreen.z>1)continue;C.positionScreen.x*=K,C.positionScreen.y*=Q,M.positionScreen.x*=K,M.positionScreen.y*=Q,L.positionScreen.x*=K,L.positionScreen.y*=Q,c.overdraw>0&&(f(C.positionScreen,M.positionScreen,c.overdraw),f(M.positionScreen,L.positionScreen,c.overdraw),f(L.positionScreen,C.positionScreen,c.overdraw)),ue.setFromPoints([C.positionScreen,M.positionScreen,L.positionScreen]),xe.isIntersectionBox(ue)===!0&&r(C,M,L,0,1,2,l,c)}ye.union(ue)}}ee.setTransform(1,0,0,1,0,0)}};
var ALG,ALGDISPLAY,Alg,AlgAnimation,BASE,COLORED,COLORS,Camera,CameraMovement,Colors,CompositeMove,ConcurrentChangers,Config,Css,CubeAnimation,Cubexp,Dom,EventHandlers,FLAGS,HOVER,Layer,Move,MoveExecution,OneChange,POV,PROPERTIES,Pieces3D,Pov,SETUPMOVES,SOLVED,SPEED,TWEAKS,TimedChanger,Tweaks,log_error,side_name,standardize_name,v3,v3_add,v3_sub,v3_x,extend=function(t,e){function n(){this.constructor=t}for(var r in e)hasProp.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty,indexOf=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1};TimedChanger=function(){function t(t){this.duration=t,this.start_time=(new Date).getTime(),this.last_time=this.start_time}return t.prototype.update=function(t){if(!this._finished)return t>this.start_time+this.duration?this.finish():this._make_change(t)},t.prototype.finish=function(){if(!this.finished())return this._make_change(this.start_time+this.duration),this._finished=!0,this._realign()},t.prototype.finished=function(){return this._finished},t.prototype._make_change=function(t){return this.do_change(this._ease(t)-this._ease(this.last_time)),this.last_time=t},t.prototype._ease=function(t){var e;return e=(t-this.start_time)/this.duration,e*e*(2-e*e)},t}(),OneChange=function(){function t(t){this.action=t}return t.prototype.update=function(t){return this.action()},t.prototype.finish=function(){},t.prototype.finished=function(){return!0},t}(),MoveExecution=function(t){function e(t,n,r,i,o){this.pieces=t,this.axis=n,this.angle_to_turn=r,e.__super__.constructor.call(this,i),o||this.finish()}return extend(e,t),e.prototype.do_change=function(t){var e,n,r,i,o;for(i=this.pieces,o=[],e=0,n=i.length;e<n;e++)r=i[e],o.push(this._rotateAroundWorldAxis(r,t*this.angle_to_turn));return o},e.prototype._rotateAroundWorldAxis=function(t,e){var n;return n=new THREE.Matrix4,n.makeRotationAxis(this.axis,e),n.multiply(t.matrix),t.matrix=n,t.rotation.setFromRotationMatrix(t.matrix)},e.prototype._realign=function(){var t,e,n,r,i,o,s,a;for(n=Math.PI/2,o=this.pieces,a=[],t=0,e=o.length;t<e;t++)r=o[t],i=r.rotation,a.push((s=[Math.round(i.x/n)*n,Math.round(i.y/n)*n,Math.round(i.z/n)*n],i.x=s[0],i.y=s[1],i.z=s[2],s));return a},e}(TimedChanger),ConcurrentChangers=function(){function t(t){this.sub_changers=t}return t.prototype.update=function(t){var e,n,r,i,o;for(i=this.sub_changers,o=[],n=0,r=i.length;n<r;n++)e=i[n],o.push(e.update(t));return o},t.prototype.finish=function(){var t,e,n,r,i;for(r=this.sub_changers,i=[],e=0,n=r.length;e<n;e++)t=r[e],i.push(t.finish());return i},t.prototype.finished=function(){var t,e,n,r;for(r=this.sub_changers,e=0,n=r.length;e<n;e++)if(t=r[e],!t.finished())return!1;return!0},t}(),CameraMovement=function(t){function e(t,n,r,i,o){this.camera=t,this.axis=n,this.angle_to_turn=r,e.__super__.constructor.call(this,i),o||this.finish()}return extend(e,t),e.prototype.do_change=function(t){return this.camera.rotate(this.axis,t*this.angle_to_turn)},e.prototype._realign=function(){return this.camera.to_position()},e}(TimedChanger),AlgAnimation=function(){function t(t){this.alg=t,this._next_alg_move()}return t.prototype.update=function(t){if(!this._finished)return this.move_changer.finished()&&this._next_alg_move(),this.move_changer.update(t)},t.prototype.finish=function(){},t.prototype.finished=function(){return this._finished},t.prototype._next_alg_move=function(){return this.alg.at_end()||!this.alg.playing?this._finished=!0:this.move_changer=this.alg.next_move().show_do()},t}(),v3=function(t,e,n){return new THREE.Vector3(t,e,n)},v3_add=function(t,e){return t.clone().add(e)},v3_sub=function(t,e){return t.clone().sub(e)},v3_x=function(t,e){return t.clone().multiplyScalar(e)},standardize_name=function(t){var e,n,r,i,o,s;for(s=[t[0],t[1],t[2]],o="",i=["U","D","F","B","R","L"],e=0,n=i.length;e<n;e++)r=i[e],indexOf.call(s,r)>=0&&(o+=r);return o},side_name=function(t){return t?t.name||t:""},log_error=function(t){return console.log("RoofPig error: "+t)},Css=function(){function t(){}var e,n,r;return n="#ededed",e="#bbb",r="#ffffff",t.CODE="<style>\n</style>",t}(),$(document).ready(function(){var t,e,n,r,i;for(console.log("Roofpig version 1.4. â™‡ (2017-03-27 14:54). Expecting jQuery 3.1.1 and Three.js 71."),console.log("jQuery version",$.fn.jquery),$("head").append(Css.CODE),CubeAnimation.initialize(),n=$(".roofpig"),console.log("Found "+n.length+" .roofpig divs"),r=[],t=0,e=n.length;t<e;t++)i=n[t],r.push(new CubeAnimation($(i)));return r}),Layer=function(){function t(t,e,n,r,i,o){this.name=t,this.normal=e,this.cycle1=n,this.cycle2=r,this.sticker_cycle=o,this.positions=this.cycle1.concat(this.cycle2,i)}var e,n;return t.by_name=function(t){return e[t]},t.side_by_name=function(t){return n[t]},t.R=new t("R",v3(-1,0,0),["UFR","DFR","DBR","UBR"],["UR","FR","DR","BR"],["R"],{B:"D",D:"F",F:"U",U:"B",L:"L",R:"R"}),t.L=new t("L",v3(1,0,0),["UBL","DBL","DFL","UFL"],["BL","DL","FL","UL"],["L"],{B:"U",U:"F",F:"D",D:"B",L:"L",R:"R"}),t.F=new t("F",v3(0,1,0),["DFL","DFR","UFR","UFL"],["FL","DF","FR","UF"],["F"],{U:"R",R:"D",D:"L",L:"U",F:"F",B:"B"}),t.B=new t("B",v3(0,-1,0),["UBL","UBR","DBR","DBL"],["UB","BR","DB","BL"],["B"],{U:"L",L:"D",D:"R",R:"U",F:"F",B:"B"}),t.U=new t("U",v3(0,0,1),["UBR","UBL","UFL","UFR"],["UR","UB","UL","UF"],["U"],{F:"R",R:"B",B:"L",L:"F",U:"U",D:"D"}),t.D=new t("D",v3(0,0,-1),["DFR","DFL","DBL","DBR"],["DF","DL","DB","DR"],["D"],{F:"L",L:"B",B:"R",R:"F",U:"U",D:"D"}),t.M=new t("M",t.L.normal,["UF","UB","DB","DF"],["U","B","D","F"],[],t.L.sticker_cycle),t.E=new t("E",t.D.normal,["BL","BR","FR","FL"],["L","B","R","F"],[],t.D.sticker_cycle),t.S=new t("S",t.F.normal,["DL","DR","UR","UL"],["L","D","R","U"],[],t.F.sticker_cycle),t.prototype.shift=function(t,e){var n,r,i,o;if(!this.sticker_cycle[t])return null;if(e<1)throw new Error("Invalid turn number: '"+e+"'");for(o=t,r=n=1,i=e;1<=i?n<=i:n>=i;r=1<=i?++n:--n)o=this.sticker_cycle[o];return o},t.prototype.on_same_axis_as=function(t){var e,n,r,i,o;for(o=0,i=["x","y","z"],n=0,r=i.length;n<r;n++)e=i[n],0===this.normal[e]&&0===t.normal[e]&&o++;return 2===o},e={R:t.R,L:t.L,F:t.F,B:t.B,D:t.D,U:t.U,M:t.M,E:t.E,S:t.S},n={R:t.R,L:t.L,F:t.F,B:t.B,D:t.D,U:t.U},t}(),Cubexp=function(){function t(t){var n,r,i,o,s,a,h,u,c,p,d,l,_,f,m,g,v,y,b,w,x,k,L,R;for(null==t&&(t=""),this.matches={},o=0,h=e.length;o<h;o++)v=e[o],this.matches[v]={};for(b=t.split(" "),s=0,u=b.length;s<u;s++)switch(i=b[s],r=this._parse(i),r.type){case"XYZ":this._add_match(r.piece,r.type_filter,r.sides);break;case"X-":for(a=0,c=e.length;a<c;a++){for(v=e[a],n=!1,w=r.piece.split(""),m=0,p=w.length;m<p;m++)L=w[m],n||(n=v.indexOf(L)>-1);n||this._add_match(v,r.type_filter)}break;case"X*":for(g=0,d=e.length;g<d;g++)for(v=e[g],x=r.piece.split(""),y=0,l=x.length;y<l;y++)L=x[y],v.indexOf(L)>-1&&this._add_match(v,r.type_filter);break;case"*":for(k=0,_=e.length;k<_;k++)v=e[k],this._add_match(v,r.type_filter);break;case"x":for(R=0,f=e.length;R<f;R++)v=e[R],v.indexOf(r.piece[0])>-1&&this._add_match(v,r.type_filter,r.piece);break;default:log_error("Ignored unrecognized Cubexp '"+i+"'.")}}var e;return e=["B","BL","BR","D","DB","DBL","DBR","DF","DFL","DFR","DL","DR","F","FL","FR","L","R","U","UB","UBL","UBR","UF","UFL","UFR","UL","UR"],t.prototype.matches_sticker=function(t,e){return null!=this.matches[standardize_name(t)][side_name(e)]},t.prototype.selected_pieces=function(){var t,e,n,r,i,o,s,a,h,u;s=[],i=this.matches;for(r in i){for(h=i[r],t="",a=!1,o=r.split(""),e=0,n=o.length;e<n;e++)u=o[e],a||(a=h[u]),t+=h[u]?u:u.toLowerCase();a&&s.push(t)}return s},t.prototype._add_match=function(t,e,n){var r,i,o,s,a,h;if(null==n&&(n=t),o="mec"[t.length-1],!e||e.indexOf(o)>-1){for(s=n.split(""),a=[],r=0,i=s.length;r<i;r++)h=s[r],a.push(this.matches[t][h]=!0);return a}},t.prototype._parse=function(t){var e,n,r,i;switch(i={},r=t.split("/"),e=r[0],i.type_filter=r[1],i.piece=standardize_name(e.toUpperCase()),n=e[e.length-1]){case"*":i.type="*"===e?"*":"X*";break;case"-":i.type="X-";break;default:e===i.piece.toLowerCase()?i.type="x":(i.type="XYZ",i.sides=standardize_name(e))}return i},t}(),Tweaks=function(){function t(t){var e,n,r,i,o,s,a,h,u,c,p,d,l,_,f,m,g,v,y,b;if(this.tweaks={},t)for(l=t.split(" "),r=0,s=l.length;r<s;r++)if(e=l[r],_=e.split(":"),y=_[0],b=_[1],b)if(1===y.length)for(f=new Cubexp(b).selected_pieces(),i=0,a=f.length;i<a;i++)for(d=f[i],m=d.split(""),o=0,h=m.length;o<h;o++)v=m[o],this._add(d.toUpperCase(),v,y);else for(p=standardize_name(b.toUpperCase()),g=b.split(""),n=c=0,u=g.length;c<u;n=++c)v=g[n],this._add(p,v,y[n])}return t.prototype.for_sticker=function(t,e){var n;return n=this.tweaks[standardize_name(t)]||{},n[side_name(e)]||[]},t.prototype._add=function(t,e,n){var r,i;if(Layer.side_by_name(e))return null==(r=this.tweaks)[t]&&(r[t]={}),null==(i=this.tweaks[t])[e]&&(i[e]=[]),this.tweaks[t][e].push(n)},t}(),Pov=function(){function t(e){this.map=t.start_map(),e&&this.track(e)}return t.start_map=function(){return{B:"B",D:"D",F:"F",L:"L",R:"R",U:"U"}},t.prototype.track=function(t){var e,n,r,i;for(Array.isArray(t)||(t=[t]),i=[],e=0,n=t.length;e<n;e++)r=t[e],i.push(r.track_pov(this.map));return i},t.prototype.hand_to_cube_map=function(){var t,e,n,r;n={},e=this.map;for(t in e)hasProp.call(e,t)&&(r=e[t],n[r]=t);return n},t.prototype.cube_to_hand=function(t){return this._case_map(this.map,t)},t.prototype.hand_to_cube=function(t){return this._case_map(this.hand_to_cube_map(),t)},t.prototype._case_map=function(t,e){var n;return e?function(){var r,i,o,s,a;for(o=e.split(""),a=[],r=0,i=o.length;r<i;r++)n=o[r],a.push(t[n]||(null!=(s=t[n.toUpperCase()])?s.toLowerCase():void 0)||n);return a}().join(""):e},t}(),Pieces3D=function(){function t(t,e,n,r){this.use_canvas=r,this.at={},this.cube_surfaces=this.use_canvas?[!0]:[!0,!1],this.sticker_size=this.use_canvas?.84:.9,this.hover_size=this.use_canvas?.91:.97,this.make_stickers(t,e,n)}var e;return e=.003,t.prototype.on=function(t){var e,n,r,i,o;for(i=t.positions,o=[],e=0,n=i.length;e<n;e++)r=i[e],o.push(this.at[r]);return o},t.prototype.move=function(t,e){var n;return n=(e+4)%4,this._track_stickers(t,n),this._track_pieces(n,t.cycle1,t.cycle2)},t.prototype.state=function(){var t,e,n,r,i;for(i="",r=["B","BL","BR","D","DB","DBL","DBR","DF","DFL","DFR","DL","DR","F","FL","FR","L","R","U","UB","UBL","UBR","UF","UFL","UFR","UL","UR"],t=0,e=r.length;t<e;t++)n=r[t],i+=this[n].sticker_locations.join("")+" ";return i},t.prototype._track_stickers=function(t,e){var n,r,i,o,s,a;for(s=this.on(t),a=[],r=0,i=s.length;r<i;r++)o=s[r],a.push(o.sticker_locations=function(){var r,i,s,a;for(s=o.sticker_locations,a=[],r=0,i=s.length;r<i;r++)n=s[r],a.push(t.shift(n,e));return a}());return a},t.prototype._track_pieces=function(t,e,n){var r,i,o,s;for(s=[],i=r=1,o=t;1<=o?r<=o:r>=o;i=1<=o?++r:--r)this._permute(e),s.push(this._permute(n));return s},t.prototype._permute=function(t){var e;return e=[this.at[t[1]],this.at[t[2]],this.at[t[3]],this.at[t[0]]],this.at[t[0]]=e[0],this.at[t[1]]=e[1],this.at[t[2]]=e[2],this.at[t[3]]=e[3],e},t.prototype.make_stickers=function(t,e,n){var r,i,o,s,a,h,u,c,p,d,l;for(u={normal:v3(0,0,0),name:"-"},s=[Layer.R,u,Layer.L],a=[],r=0,i=s.length;r<i;r++)p=s[r],a.push(function(){var r,i,s,a;for(s=[Layer.F,u,Layer.B],a=[],r=0,i=s.length;r<i;r++)d=s[r],a.push(function(){var r,i,s,a,_,f,m;for(_=[Layer.U,u,Layer.D],m=[],r=0,i=_.length;r<i;r++){for(l=_[r],o=this._new_piece(p,d,l),f=[p,d,l],a=0,s=f.length;a<s;a++)h=f[a],h!==u&&(c=n.to_draw(o.name,h),this._add_sticker(h,o,c),c.hovers&&e>1&&this._add_hover_sticker(h,o,c,e),this._add_cubeside(h,o,n.of("cube")));this[o.name]=this.at[o.name]=o,m.push(t.add(o))}return m}.call(this));return a}.call(this));return a},t.prototype._new_piece=function(t,e,n){var r;return r=new THREE.Object3D,r.name=standardize_name(t.name+e.name+n.name),r.sticker_locations=r.name.split(""),r.middle=v3(2*t.normal.x,2*e.normal.y,2*n.normal.z),r},t.prototype._add_sticker=function(t,n,r){var i,o,s;if(s=this._offsets(t.normal,this.sticker_size,!1),i=s[0],o=s[1],n.add(this._diamond(this._square_center(t,n.middle,1+e),i,o,r.color)),r.x_color)return this._add_X(t,n,r.x_color,1+2*e,!0)},t.prototype._add_hover_sticker=function(t,n,r,i){var o,s,a;if(a=this._offsets(t.normal,this.hover_size,!0),o=a[0],s=a[1],n.add(this._diamond(this._square_center(t,n.middle,i),o,s,r.color)),r.x_color)return this._add_X(t,n,r.x_color,i-e,!1)},t.prototype._add_cubeside=function(t,e,n){var r,i,o,s,a,h,u,c;for(a=this.cube_surfaces,u=[],o=0,s=a.length;o<s;o++)c=a[o],h=this._offsets(t.normal,1,c),r=h[0],i=h[1],u.push(e.add(this._diamond(this._square_center(t,e.middle,1),r,i,n)));return u},t.prototype._add_X=function(t,e,n,r,i){var o,s,a,h;return h=this._offsets(t.normal,.54,i),s=h[0],a=h[1],o=this._square_center(t,e.middle,r),e.add(this._rect(o,s,v3_x(a,.14),n)),e.add(this._rect(o,v3_x(s,.14),a,n))},t.prototype._square_center=function(t,e,n){return v3_add(e,v3_x(t.normal,n))},t.prototype._rect=function(t,e,n,r){return this._diamond(t,v3_add(e,n),v3_sub(e,n),r)},t.prototype._diamond=function(t,e,n,r){var i;return i=new THREE.Geometry,i.vertices.push(v3_add(t,e),v3_add(t,n),v3_sub(t,e),v3_sub(t,n)),i.faces.push(new THREE.Face3(0,1,2),new THREE.Face3(0,2,3)),i.computeFaceNormals(),i.computeBoundingSphere(),new THREE.Mesh(i,new THREE.MeshBasicMaterial({color:r,overdraw:.8}))},t.prototype._offsets=function(t,e,n){var r,i,o,s,a;return r=v3(t.y,t.z,t.x),i=v3(t.z,t.x,t.y),a=(t.y+t.z+t.x)*(n?-1:1),o=v3_add(r,i).multiplyScalar(e*a),s=v3_sub(r,i).multiplyScalar(e),[o,s]},t}(),Move=function(){function t(e,n,r){var i;this.world3d=n,this.speed=null!=r?r:400,i=t._parse_code(e),this.layer=i[0],this.turns=i[1],this.is_rotation=i[2],this.turn_time=this.speed/2*(1+Math.abs(this.turns))}return t._parse_code=function(e){var n,r,i,o;if(o=t.parse_turns(e.substring(1)),n=">"===(i=e.substring(1))||">>"===i||"<"===i||"<<"===i,r=Layer.by_name(e[0]),!r||!o)throw new Error("Invalid Move code '"+e+"'");return[r,o,n]},t.parse_turns=function(t){switch(t){case"1":case"":case">":return 1;case"2":case"Â²":case">>":return 2;case"3":case"'":case"<":return-1;case"Z":case"2'":case"<<":return-2}},t.prototype.do=function(){return this._do(this.turns,!1)},t.prototype.undo=function(){return this._do(-this.turns,!1)},t.prototype.mix=function(){if(!this.is_rotation)return this.undo()},t.prototype.track_pov=function(t){var e,n,r,i,o,s,a,h;for(s=[this.layer.cycle1,this.layer.cycle2],a=[],r=0,i=s.length;r<i;r++)e=s[r],1===e[0].length&&a.push(function(){var r;r=[];for(h in t)o=t[h],r.push(function(){var r,i;for(i=[],n=r=0;r<=3;n=++r)o===e[n]?i.push(t[h]=e[(n-this.turns+4)%4]):i.push(void 0);return i}.call(this));return r}.call(this));return a},t.prototype.as_brdflu=function(){var t,e,n;if(this.is_rotation)return"";switch(t={1:"",2:"2","-1":"'","-2":"2"},e=t[this.turns],n=t[-this.turns],this.layer){case Layer.M:return"L"+n+" R"+e;case Layer.E:return"D"+n+" U"+e;case Layer.S:return"B"+e+" F"+n;default:return this.to_s().replace("Z","2")}},t.prototype.show_do=function(){return this._do(this.turns,!0)},t.prototype.show_undo=function(){return this._do(-this.turns,!0)},t.prototype._do=function(t,e){return this.is_rotation?new CameraMovement(this.world3d.camera,this.layer.normal,t*Math.PI/2,this.turn_time,e):(this.world3d.pieces.move(this.layer,t),new MoveExecution(this.world3d.pieces.on(this.layer),this.layer.normal,t*-Math.PI/2,this.turn_time,e))},t.prototype.count=function(t){return t||!this.is_rotation?1:0},t.prototype.to_s=function(){var t;return t={true:{1:">",2:">>","-1":"<","-2":"<<"},false:{1:"",2:"2","-1":"'","-2":"Z"}},""+this.layer.name+t[this.is_rotation][this.turns]},t.displayify=function(t,e){var n;return n=t.replace("Z",e.Zcode),e.fancy2s&&(n=n.replace("2","Â²")),n},t.prototype.display_text=function(e){return e.rotations||!this.is_rotation?t.displayify(this.to_s(),e):""},t}(),EventHandlers=function(){function t(){}var e,n,r,i,o,s,a,h,u,c,p,d,l,_,f,m,g,v,y,b,w,x,k;return t.initialized=!1,t.set_focus=function(t){if(this._focus!==t&&(this._focus&&this.dom.has_focus(!1),this._focus=t,!this.focus().is_null))return this.camera=this._focus.world3d.camera,this.dom=this._focus.dom,this.dom.has_focus(!0)},e={add_changer:function(){return{}},is_null:!0},t.focus=function(){return this._focus||e},t.initialize=function(){if(!this.initialized)return $("body").keydown(function(e){}),$("body").keyup(function(e){return t.key_up(e)}),$(document).on("mousedown",".roofpig",function(e){return t.mouse_down(e,$(this).data("cube-id"))}),$("body").mousemove(function(e){return t.mouse_move(e)}),$("body").mouseup(function(e){return t.mouse_end(e)}),$("body").mouseleave(function(e){return t.mouse_end(e)}),$(document).on("click",".roofpig",function(e){var n;return n=CubeAnimation.by_id[$(this).data("cube-id")],t.set_focus(n)}),$(document).on("click",".roofpig button",function(t){var e,n,r;return r=$(this).attr("id").split("-"),e=r[0],n=r[1],CubeAnimation.by_id[n].button_click(e,t.shiftKey)}),$(document).on("click",".roofpig-help-button",function(t){var e,n,r;return r=$(this).attr("id").split("-"),e=r[0],n=r[1],CubeAnimation.by_id[n].dom.show_help()}),this.initialized=!0},t.mouse_down=function(t,e){if(this.dom.remove_help(),e===this.focus().id)return this.bend_start_x=t.pageX,this.bend_start_y=t.pageY,this.bending=!0},t.mouse_end=function(t){return this.focus().add_changer("camera",new OneChange(function(t){return function(){return t.camera.bend(0,0)}}(this))),this.bending=!1},t.mouse_move=function(t){var e,n;if(this.bending)return e=-.02*(t.pageX-this.bend_start_x)/this.dom.scale,n=-.02*(t.pageY-this.bend_start_y)/this.dom.scale,t.shiftKey&&(n=0),this.focus().add_changer("camera",new OneChange(function(t){return function(){return t.camera.bend(e,n)}}(this)))},t.key_down=function(t){var e,s,a,h,d,_,f,v,b;if(!this.focus().is_null)return a=this.dom.remove_help(),!(!t.ctrlKey&&!t.metaKey)||(_=[t.keyCode,t.shiftKey,t.altKey],h=_[0],f=_[1],e=_[2],indexOf.call(k,h)>=0?(v=f?3:e?2:1,this._move(""+x[h]+v)):e?b=!0:h===y?(d=f?this.focus().previous_cube():this.focus().next_cube(),this.set_focus(d)):h===l||h===g&&f?this.focus().add_changer("pieces",new OneChange(function(t){return function(){return t.focus().alg.to_end(t.focus().world3d)}}(this))):indexOf.call(n,h)>=0?this._fake_click_down(this._button_for(h,f)):indexOf.call(w,h)>=0?(s=function(){switch(h){case i:case p:return"up";case r:case o:return"dr";case u:case c:return"dl"}}(),v=function(){switch(h){case i:case r:case u:return 1;case p:case o:case c:return-1}}(),this._rotate(s,v)):h===m?a||this.focus().dom.show_help():b=!0,b?void 0:(t.preventDefault(),t.stopPropagation()))},t._button_for=function(t,e){switch(t){case _:return this.dom.reset;case f:return e?this.dom.reset:this.dom.prev;case g:return this.dom.next;case v:return this.dom.play_or_pause}},t.key_up=function(t){var e,r;return r=t.keyCode,e=indexOf.call(n,r)>=0,e&&this.down_button&&(this._fake_click_up(this.down_button),this.down_button=null),e},t._fake_click_down=function(t){if(!t.attr("disabled"))return this.down_button=t,t.addClass("roofpig-button-fake-active")},t._fake_click_up=function(t){if(!t.attr("disabled"))return t.removeClass("roofpig-button-fake-active"),t.click()},t._rotate=function(t,e){var n;return n=-Math.PI/2*e,this.focus().add_changer("camera",new CameraMovement(this.camera,this.camera.user_dir[t],n,500,(!0)))},t._move=function(t){return this.focus().add_changer("pieces",new Move(t,this.focus().world3d,200).show_do())},y=9,v=32,l=35,_=36,f=37,b=38,g=39,d=40,r=65,i=67,o=68,s=74,a=75,h=76,u=83,c=88,p=90,m=191,n=[v,_,f,g],w=[i,p,r,o,u,c],k=[s,a,h],x={},x[s]="U",x[a]="F",x[h]="R",t}(),Dom=function(){function t(t,e,n,r,i){this.cube_id=t,this.div=e,this.div.css({position:"relative","font-family":'"Lucida Sans Unicode", "Lucida Grande", sans-serif'}),this.has_focus(!1),this.div.attr("data-cube-id",this.cube_id),n.setSize(this.div.width(),this.div.width()),this.div.append(n.domElement),this.scale=this.div.width()/400,this.hscale=Math.max(this.scale,.375),r&&this.add_alg_area(i)}var e;return t.prototype.has_focus=function(t){var e,n;return e=t?"gray":"#eee",n=t?"pointer":"default",this.div.css({border:"2px solid "+e,cursor:n})},t.prototype.alg_changed=function(t,e,n,r,i){var o,s,a,h,u,c,p;if(t)for(c=this.buttons,s=0,h=c.length;s<h;s++)o=c[s],o===this.play?o.hide():this._show(o,o===this.pause);else for(p=this.buttons,a=0,u=p.length;a<u;a++)switch(o=p[a]){case this.reset:case this.prev:this._show(o,!e);break;case this.next:case this.play:this._show(o,!n);break;case this.pause:o.hide()}if(this.play_or_pause=t?this.pause:this.play,this.count.html(r),this.alg_text)return this.alg_past.text(i.past),this.alg_future.text(" "+i.future)},t.prototype.show_help=function(){return this.help=$("<div/>").addClass("roofpig-help"),this.help.append($("<div>Keyboard shortcuts</div>").css({"text-align":"center","font-weight":"bold"}),"<div><span>â†’</span> - Next move</div>","<div/><span>â†</span> - Previous move</div>","<div/><span>â‡§</span>+<span>â†’</span> - To end</div>","<div/><span>â‡§</span>+<span>â†</span> - To start</div>","<div/><span>&nbsp;space&nbsp;</span> - Play/Pause</div>","<div/><span>Tab</span> - Next Cube</div>"),this.div.append(this.help),this.help.css({right:(this.div.width()-this.help.outerWidth())/2+"px"})},t.prototype.remove_help=function(){var t;return this.help&&(this.help.remove(),this.help=null,t=!0),t},t.prototype.add_alg_area=function(t){return this.div.append($("<div/>",{text:"?",id:"help-"+this.cube_id}).addClass("roofpig-help-button")),this.alg_area=$("<div/>").height(this.div.height()-this.div.width()).width(this.div.width()).css({"border-top":"1px solid #ccc"}),this.div.append(this.alg_area),t&&(this.alg_text=$("<div/>").width(this.div.width()).addClass("roofpig-algtext"),this.alg_area.append(this.alg_text),this.alg_past=$("<span/>").addClass("roofpig-past-algtext"),this.alg_future=$("<span/>"),this.alg_text.append(this.alg_past,this.alg_future)),this.reset=this._make_button("â†©","reset"),this.prev=this._make_button("-","prev"),this.next=this._make_button("+","next"),this.pause=this._make_button("â…¡","pause"),this.play=this._make_button("â–¶","play"),this.count=this._make_count_area(),this.buttons=[this.reset,this.prev,this.next,this.pause,this.play]},e={M:108,"+":100,">":100,"<":100,w:98,D:94,U:87,2:80,R:80,x:78,Z:77,B:73,z:73,F:68,E:68,S:68,L:67,y:65,"Â²":53," ":40,"'":29},t.prototype.init_alg_text=function(t){var n,r,i,o,s,a;if(this.alg_text){for(a=0,s=t.split(""),i=0,o=s.length;i<o;i++)n=s[i],a+=e[n]||80,e[n]||log_error("Unknown char width: '"+n+"'");return r=24*this.scale*Math.min(1,1970/a),this.alg_text.height(1.2*r).css({"font-size":r})}},t.prototype._show=function(t,e){return t.show(),e?(t.prop("disabled",!1),t.addClass("roofpig-button-enabled")):(t.prop("disabled",!0),t.removeClass("roofpig-button-enabled"))},t.prototype._make_button=function(t,e){var n;return n=$("<button/>",{text:t,id:e+"-"+this.cube_id}),this.alg_area.append(n),n.addClass("roofpig-button"),n.css({"font-size":28*this.hscale,float:"left",height:40*this.hscale,width:76*this.scale})},t.prototype._make_count_area=function(){var t;return t=$("<div/>",{id:"count-"+this.cube_id}).addClass("roofpig-count"),this.alg_area.append(t),t.height(40*this.hscale).width(80*this.scale).css("font-size",24*this.hscale)},t}(),CompositeMove=function(){function t(t,e,n,r){var i,o,s,a,h,u,c;for(this.official_text=null!=r?r:null,this.moves=function(){var r,o,s,a;for(s=t.split("+"),a=[],r=0,o=s.length;r<o;r++)i=s[r],a.push(new Move(i,e,n));return a}(),u=function(){var t,e,n,r;for(n=this.moves,r=[],t=0,e=n.length;t<e;t++)a=n[t],a.is_rotation||r.push(a);return r}.call(this),c=u.slice(1),o=0,s=c.length;o<s;o++)if(h=c[o],!u[0].layer.on_same_axis_as(h.layer))throw new Error("Impossible Move combination '"+t+"'")}return t.prototype.do=function(){return new ConcurrentChangers(this.moves.map(function(t){return t.do()}))},t.prototype.undo=function(){return new ConcurrentChangers(this.moves.map(function(t){return t.undo()}))},t.prototype.mix=function(){return new ConcurrentChangers(this.moves.map(function(t){return t.mix()}))},t.prototype.show_do=function(){return new ConcurrentChangers(this.moves.map(function(t){return t.show_do()}))},t.prototype.show_undo=function(){return new ConcurrentChangers(this.moves.map(function(t){return t.show_undo()}))},t.prototype.track_pov=function(t){var e,n,r,i,o;for(i=this.moves,o=[],e=0,n=i.length;e<n;e++)r=i[e],o.push(r.track_pov(t));return o},t.prototype.count=function(t){var e,n,r,i,o;if(this.official_text)return 1;for(o=0,i=this.moves,e=0,n=i.length;e<n;e++)r=i[e],o+=r.count(t);return o},t.prototype.to_s=function(){return"("+this.moves.map(function(t){return t.to_s()}).join(" ")+")"},t.prototype.as_brdflu=function(){var t,e,n,r,i;for(r=this.moves.map(function(t){return t.as_brdflu()}).join(" ").split(" ").sort().join(" "),n=["B","R","D","F","L","U"],t=0,e=n.length;t<e;t++)i=n[t],r=r.replace(i+" "+i+"'",""),r=r.replace(i+"2 "+i+"2","");return r.replace(/[ ]+/g," ").replace(/^ +| +$/g,"")},t.prototype.display_text=function(t){var e,n;return this.official_text?Move.displayify(this.official_text,t):(e=this.moves.map(function(e){return e.display_text(t)}),function(){var t,r,i;for(i=[],t=0,r=e.length;t<r;t++)n=e[t],n&&i.push(n);return i}().join("+"))},t}(),Alg=function(){function t(t,e,n,r,i){var o,s,a,h;for(this.move_codes=t,this.world3d=e,this.algdisplay=n,this.speed=r,this.dom=i,this.moves=[],h=this.move_codes.split(" "),s=0,a=h.length;s<a;s++)o=h[s],o.length>0&&this.moves.push(this._make_move(o));this.next=0,this.playing=!1,this._update_dom("first time")}var e;return t.prototype.next_move=function(){if(!this.at_end())return this.next+=1,this.at_end()&&(this.playing=!1),this._update_dom(),this.moves[this.next-1]},t.prototype.prev_move=function(){if(!this.at_start())return this.next-=1,this._update_dom(),this.moves[this.next]},t.prototype.play=function(){return this.playing=!0,this._update_dom(),new AlgAnimation(this)},t.prototype.stop=function(){return this.playing=!1,this._update_dom()},t.prototype.to_end=function(){var t;for(t=[];!this.at_end();)t.push(this.next_move().do());return t},t.prototype.to_start=function(){var t;for(t=[];!this.at_start();)t.push(this.prev_move().undo());return t},t.prototype.at_start=function(){return 0===this.next},t.prototype.at_end=function(){return this.next===this.moves.length},t.prototype.mix=function(){var t;for(this.next=this.moves.length,t=[];!this.at_start();)t.push(this.prev_move().mix());return t},t.prototype.to_s=function(){return this.moves.map(function(t){return t.to_s()}).join(" ")},t.prototype.display_text=function(){var t,e,n,r,i,o,s,a,h;for(t=s=[],e=[],a=this.moves,n=r=0,i=a.length;r<i;n=++r)o=a[n],this.next===n&&(t=e),h=o.display_text(this.algdisplay),h&&t.push(h);return{past:s.join(" "),future:e.join(" ")}},e={"-2":["Z","2"],"-1":["'",""],1:["","'"],2:["2","Z"]},t.prototype._make_move=function(t){var n,r,i,o,s,a,h,u,c;return t.indexOf("+")>-1?new CompositeMove(t,this.world3d,this.speed):"x"===(i=t[0])||"y"===i||"z"===i?(o=e[Move.parse_turns(t.substring(1))],u=o[0],c=o[1],r=function(){switch(t[0]){case"x":return"R"+u+"+M"+c+"+L"+c;case"y":return"U"+u+"+E"+c+"+D"+c;case"z":return"F"+u+"+S"+u+"+B"+c}}(),new CompositeMove(r,this.world3d,this.speed,t)):("w"!==t[1]||"U"!==(s=t[0])&&"D"!==s&&"L"!==s&&"R"!==s&&"F"!==s&&"B"!==s||(n=2),"u"!==(a=t[0])&&"d"!==a&&"l"!==a&&"r"!==a&&"f"!==a&&"b"!==a||(n=1),n?(h=e[Move.parse_turns(t.substring(n))],u=h[0],c=h[1],r=function(){switch(t[0].toUpperCase()){case"R":return"R"+u+"+M"+c;case"L":return"L"+u+"+M"+u;case"U":return"U"+u+"+E"+c;case"D":return"D"+u+"+E"+u;case"F":return"F"+u+"+S"+u;case"B":return"B"+u+"+S"+c}}(),new CompositeMove(r,this.world3d,this.speed,t)):new Move(t,this.world3d,this.speed))},t.prototype.unhand=function(){var t,e,n,r,i,o;for(r=new Pov,o=[],i=this.moves,t=0,e=i.length;t<e;t++)n=i[t],o.push(r.hand_to_cube(n.as_brdflu())),r.track(n);return o.join(" ").replace(/[ ]+/g," ").replace(/^ +| +$/g,"")},t.pov_from=function(e){return new Pov(new t(e).moves)},t.prototype._update_dom=function(t){if(null==t&&(t="later"),this.dom&&this.moves.length>0)return"first time"===t&&this.dom.init_alg_text(this.display_text().future),this.dom.alg_changed(this.playing,this.at_start(),this.at_end(),this._count_text(),this.display_text())},t.prototype._count_text=function(){var t,e,n,r,i,o,s,a;for(a=e=0,s=this.moves,n=r=0,i=s.length;r<i;n=++r)o=s[n],t=o.count(this.algdisplay.rotations),this.next>n&&(e+=t),a+=t;return e+"/"+a},t}(),Colors=function(){function t(e,n,r,i,o){null==o&&(o=""),this.colored=new Cubexp(e.cube_to_hand(n)||"*"),this.solved=new Cubexp(e.cube_to_hand(r)),this.tweaks=new Tweaks(e.cube_to_hand(i)),this.side_colors=t._set_colors(o,e.hand_to_cube_map())}var e;return t.prototype.to_draw=function(t,e){var n,r,i,o,s;for(o={hovers:!1,color:this.of(e)},this.solved.matches_sticker(t,e)?o.color=this.of("solved"):this.colored.matches_sticker(t,e)?o.hovers=!0:o.color=this.of("ignored"),i=this.tweaks.for_sticker(t,e),n=0,r=i.length;n<r;n++)switch(s=i[n],o.hovers=!0,s){case"X":case"x":o.x_color={X:"black",x:"white"}[s];break;default:Layer.by_name(s)?o.color=this.of(s):log_error("Unknown tweak: '"+s+"'")}return o},t.prototype.of=function(t){var e;if(e=t.name||t,!this.side_colors[e])throw new Error("Unknown sticker type '"+t+"'");return this.side_colors[e]},e={g:"#0d0",b:"#07f",r:"red",o:"orange",y:"yellow",w:"#eee"},t._set_colors=function(t,n){var r,i,o,s,a,h,u,c,p,d,l;for(i=e,d={R:i.g,L:i.b,F:i.r,B:i.o,U:i.y,D:i.w,solved:"#444",ignored:"#888",cube:"black"},u=t.split(" "),o=0,s=u.length;o<s;o++)a=u[o],c=a.split(":"),l=c[0],r=c[1],l={s:"solved",i:"ignored",c:"cube"}[l]||l,d[l]=e[r]||r;return h=d,p=[h[n.U],h[n.D],h[n.R],h[n.L],h[n.F],h[n.B]],
h.U=p[0],h.D=p[1],h.R=p[2],h.L=p[3],h.F=p[4],h.B=p[5],d},t}(),Config=function(){function t(e){this.raw_input=t._parse(e),this.base=this.base_config(this.raw_input[BASE],e),this.alg=this.raw(ALG),this.algdisplay=this._alg_display(),this.colors=new Colors(Alg.pov_from(this.alg),this.raw(COLORED),this.raw(SOLVED),this.raw(TWEAKS),this.raw(COLORS)),this.flags=this.raw(FLAGS),this.hover=this._hover(),this.pov=this.raw(POV,"Ufr"),this.setup=this.raw(SETUPMOVES),this.speed=this.raw(SPEED,400)}return t.prototype.flag=function(t){return this.flags.indexOf(t)>-1},t.prototype.raw=function(t,e){return null==e&&(e=""),this.raw_input[t]||this.base.raw(t)||e},t.prototype.base_config=function(e,n){var r;return r=window["ROOFPIG_CONF_"+e],e&&!r&&log_error("'ROOFPIG_CONF_"+e+"' does not exist"),n&&n===r&&(log_error(r+" tries to inherit from itself."),r=null),r?new t(r):{raw:function(){}}},t.prototype._hover=function(){var t;switch(t=this.raw(HOVER,"near")){case"none":return 1;case"near":return 2;case"far":return 7.1;default:return t}},t.prototype._alg_display=function(){var t,e;return t=this.raw(ALGDISPLAY),e={},e.fancy2s=t.indexOf("fancy2s")>-1,e.rotations=t.indexOf("rotations")>-1,e.Zcode="2",t.indexOf("2p")>-1&&(e.Zcode="2'"),t.indexOf("Z")>-1&&(e.Zcode="Z"),e},t._parse=function(t){var e,n,r,i,o,s,a,h;if(!t)return{};for(a={},s=t.split("|"),r=0,o=s.length;r<o;r++)e=s[r],n=e.indexOf("="),i=e.substring(0,n).trim(),h=e.substring(n+1).trim(),a[i]=h,PROPERTIES.indexOf(i)===-1&&log_error("Unknown config parameter '"+i+"' ignored");return a},t}(),PROPERTIES=[ALG="alg",BASE="base",ALGDISPLAY="algdisplay",COLORED="colored",COLORS="colors",FLAGS="flags",HOVER="hover",POV="pov",SETUPMOVES="setupmoves",SOLVED="solved",SPEED="speed",TWEAKS="tweaks"],CubeAnimation=function(){function t(e){var n,r;if(!t.canvas_browser)return e.html("Your browser does not support <a href='http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation'>WebGL</a>.<p/> Find out how to get it <a href='http://get.webgl.org/'>here</a>."),void e.css({background:"#f66"});try{this.id=t.last_id+=1,t.by_id[this.id]=this,this.config=new Config(e.data("config")),r=this.config.flag("canvas")||!t.webgl_browser||t.webgl_cubes>=16,r?this.renderer=new THREE.CanvasRenderer({alpha:!0}):(t.webgl_cubes+=1,this.renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0})),this.dom=new Dom(this.id,e,this.renderer,""!==this.config.alg,this.config.flag("showalg")),this.scene=new THREE.Scene,this.world3d={camera:new Camera(this.config.hover,this.config.pov),pieces:new Pieces3D(this.scene,this.config.hover,this.config.colors,r)},this.alg=new Alg(this.config.alg,this.world3d,this.config.algdisplay,this.config.speed,this.dom),this.config.setup&&new Alg(this.config.setup,this.world3d).to_end(),this.config.flag("startsolved")||this.alg.mix(),1===this.cube_count()&&EventHandlers.set_focus(this),this.changers={},this.animate(!0),EventHandlers.initialize()}catch(t){n=t,e.html(n.message),e.css({background:"#f66"})}}return t.last_id=0,t.by_id={},t.webgl_cubes=0,t.initialize=function(){return t.webgl_browser=function(){var t;try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(e){return t=e,!1}}(),t.canvas_browser=!!window.CanvasRenderingContext2D,t.canvas_browser?t.webgl_browser?void 0:log_error("No WebGL support in this browser. Falling back on regular Canvas."):log_error("No Canvas support in this browser. Giving up.")},t.create_in_dom=function(e,n,r){var i;return i=$("<div "+r+' data-config="'+n+'"></div>').appendTo($(e)),new t(i)},t.prototype.next_cube=function(){var e,n;return e=Object.keys(t.by_id),n=e[(e.indexOf(this.id.toString())+1)%e.length],t.by_id[n]},t.prototype.previous_cube=function(){var e,n;return e=Object.keys(t.by_id),n=e[(e.indexOf(this.id.toString())+e.length-1)%e.length],t.by_id[n]},t.prototype.remove=function(){var e;return this===EventHandlers.focus()&&(e=1===this.cube_count()?null:this.next_cube(),EventHandlers.set_focus(e)),delete t.by_id[this.id],this.dom.div.remove()},t.prototype.cube_count=function(){return Object.keys(t.by_id).length},t.prototype.animate=function(t){var e,n,r,i,o;null==t&&(t=!1),i=(new Date).getTime(),o=this.changers;for(n in o)hasProp.call(o,n)&&(r=o[n],r&&(r.update(i),r.finished()&&(this.changers[n]=null),e=!0));return(e||t)&&this.renderer.render(this.scene,this.world3d.camera.cam),requestAnimationFrame(function(t){return function(){return t.animate()}}(this))},t.prototype.add_changer=function(t,e){return this.changers[t]&&this.changers[t].finish(),this.changers[t]=e},t.prototype.button_click=function(t,e){var n;switch(t){case"play":n=e?new OneChange(function(t){return function(){return t.alg.to_end(t.world3d)}}(this)):this.alg.play(this.world3d);break;case"pause":this.alg.stop();break;case"next":this.alg.at_end()||(n=this.alg.next_move().show_do(this.world3d));break;case"prev":this.alg.at_start()||(n=this.alg.prev_move().show_undo(this.world3d));break;case"reset":n=new OneChange(function(t){return function(){return t.alg.to_start(t.world3d)}}(this))}if(n)return this.add_changer("pieces",n)},t}(),Camera=function(){function t(n,r){var i;this.cam=new THREE.PerspectiveCamera(this._view_angle(n,e),1,1,100),i=t._POVs[r],i||(i=t._POVs.Ufr,log_error("Invalid POV '"+this.pov_code+"'. Using Ufr")),this.cam.position.copy(i.pos),this.cam.up.copy(i.up),this.user_dir={dr:i.xn.clone(),dl:i.yn.clone(),up:i.zn.clone()},this._cam_moved()}var e;return e=25,t.prototype.rotate=function(t,e){var n,r,i,o;for(i=[this.cam.position,this.cam.up,this.user_dir.dl,this.user_dir.dr,this.user_dir.up],n=0,r=i.length;n<r;n++)o=i[n],o.applyAxisAngle(t,e);return this._cam_moved()},t.prototype.to_position=function(){var t,e,n,r,i,o;for(n=[this.cam.position,this.cam.up,this.user_dir.dl,this.user_dir.dr,this.user_dir.up],i=[],t=0,e=n.length;t<e;t++)o=n[t],i.push((r=[Math.round(o.x),Math.round(o.y),Math.round(o.z)],o.x=r[0],o.y=r[1],o.z=r[2],r));return i},t.prototype.bend=function(t,e){var n,r,i,o,s,a,h;for(a=v3_x(this.user_dir.up,t),h=v3_sub(this.user_dir.dr,this.user_dir.dl).normalize().multiplyScalar(e),n=v3_add(a,h).normalize(),this.cam.position.copy(this.unbent_position),this.cam.up=this.unbent_up.clone(),o=[this.cam.position,this.cam.up],r=0,i=o.length;r<i;r++)s=o[r],s.applyAxisAngle(n,Math.sqrt(t*t+e*e));return this.cam.lookAt(v3(0,0,0))},t.prototype._view_angle=function(t,e){var n,r,i;return i=2*Math.sqrt(t*t+4*t+13),r=Math.sqrt(3*e*e)-2,n=1.015+.13*(5-t)/4,2*n*Math.atan(i/(2*r))*(180/Math.PI)},t.prototype._cam_moved=function(){return this.cam.lookAt(v3(0,0,0)),this.unbent_up=this.cam.up.clone(),this.unbent_position=this.cam.position.clone()},t._flip=function(t,e){var n;return e>0&&(n=[t.yn,t.xn],t.xn=n[0],t.yn=n[1]),t},t._set_perms=function(t,e,n,r,i){return t[e+n+r]=t[e+r+n]=t[n+e+r]=t[n+r+e]=t[r+e+n]=t[r+n+e]=i},t._POVs=function(){var n,r,i,o,s,a,h,u,c,p,d,l,_,f,m,g,v,y,b,w,x,k,L,R,D,C,U;for(m={},c=[Layer.U,Layer.D],n=0,o=c.length;n<o;n++)for(R=c[n],p=[R.name,R.name.toLowerCase(),R.normal.clone()],U=p[0],D=p[1],C=p[2],d=[Layer.F,Layer.B],r=0,s=d.length;r<s;r++)for(w=d[r],l=[w.name,w.name.toLowerCase(),w.normal.clone()],L=l[0],x=l[1],k=l[2],_=[Layer.R,Layer.L],i=0,a=_.length;i<a;i++)g=_[i],f=[g.name,g.name.toLowerCase(),g.normal.clone()],b=f[0],v=f[1],y=f[2],u=v3(y.x,k.y,C.z).multiplyScalar(e),h=y.x*k.y*C.z,t._set_perms(m,U,x,v,t._flip({pos:u,up:C,zn:C,yn:k,xn:y},h)),t._set_perms(m,D,L,v,t._flip({pos:u,up:k,zn:k,yn:y,xn:C},h)),t._set_perms(m,D,x,b,t._flip({pos:u,up:y,zn:y,yn:C,xn:k},h));return m}(),t}();
